<div class="col-lg-12">
  <div id="total-feature-completeness-errors"></div>
  <table id="table_id" class="display">
    <thead>
      <tr>
        <th>Status</th>
        <th>Name</th>
        <th>Date</th>
        <th>Comment</th>
      </tr>
    </thead>
    <tbody>
    </tbody>
  </table>
</div>
<script type="text/javascript">
  function renderErrorsWarnings() {
    var dataTable = $('#table_id').DataTable({
      "lengthChange": false,
      columns: [
        {"data": "status"},
        {"data": "name"},
        {"data": "date"},
        {"data": "comment"}
      ]
    });
    var errorsFilesCount = {{ feature_completeness['errors_files_count']}};
    var totalErrors = 0;

    for (var i = 1; i <= errorsFilesCount; i++) {
      var errorsUrl = "{{ url | safe }}" + '/errors_' + i + '.json';
      $.ajax({
        url: errorsUrl,
        dataType: 'json',
        success: function(data) {
          totalErrors += data.length;
          $('#total-feature-completeness-errors').html(totalErrors);
          for (var i = 0; i < data.length; i++) {
            data[i]['name'] = buildLink(data[i].id, data[i].type);
            data[i].comment = buildComment(data[i].status, data[i].comment);
            dataTable.row.add(data[i]).draw();
          }
        }
      });
    }
  }


  function buildLink(id, type) {
    return `<a href="https://www.openstreetmap.org/${type}/${id}" target="_blank">${type}:${id}</a>`
  }

  function buildComment(status, comment) {
    if (status === 'error') {
      return `<div class="error-completeness">Errors: ${comment}</div>`
    } else if (status === 'warning') {
      return `<div class="warning-completeness">Warnings: ${comment}</div>`
    }
  }

  renderErrorsWarnings();
</script>